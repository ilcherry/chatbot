<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç®€å•æµ‹è¯• - ChatBot</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .info {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .success {
      color: #155724;
      background: #d4edda;
      padding: 15px;
      border-radius: 5px;
      margin: 10px 0;
    }
    .error {
      color: #721c24;
      background: #f8d7da;
      padding: 15px;
      border-radius: 5px;
      margin: 10px 0;
    }
    button {
      padding: 10px 20px;
      background: #5b6fd8;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
    }
    button:hover {
      background: #4a5fc7;
    }
    #console {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 5px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div class="info">
    <h1>ğŸ§ª ChatBot Widget - ç®€å•æµ‹è¯•é¡µé¢</h1>
    <p>è¿™æ˜¯ä¸€ä¸ªæœ€å°åŒ–çš„æµ‹è¯•é¡µé¢ï¼Œç”¨äºéªŒè¯ <code>process is not defined</code> é”™è¯¯æ˜¯å¦å·²ä¿®å¤ã€‚</p>
  </div>

  <div class="info">
    <h2>æµ‹è¯•çŠ¶æ€</h2>
    <div id="status">æ­£åœ¨åŠ è½½...</div>
  </div>

  <div class="info">
    <h2>æ§åˆ¶æŒ‰é’®</h2>
    <button onclick="testOpen()">æ‰“å¼€èŠå¤©çª—å£</button>
    <button onclick="testClose()">å…³é—­èŠå¤©çª—å£</button>
    <button onclick="testToggle()">åˆ‡æ¢èŠå¤©çª—å£</button>
    <button onclick="reloadPage()">åˆ·æ–°é¡µé¢</button>
  </div>

  <div class="info">
    <h2>æ§åˆ¶å°è¾“å‡º</h2>
    <div id="console"></div>
  </div>

  <!-- å¼•å…¥ChatBot Widget -->
  <link rel="stylesheet" href="./dist/chatbot-widget.css">
  <script src="./dist/chatbot-widget.iife.js"></script>

  <script>
    const consoleDiv = document.getElementById('console');
    const statusDiv = document.getElementById('status');
    let chatbot = null;
    let loadSuccess = false;

    // æ•è·æ§åˆ¶å°è¾“å‡º
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const colors = {
        info: '#4fc3f7',
        success: '#66bb6a',
        error: '#ef5350',
        warn: '#ffa726'
      };
      consoleDiv.innerHTML += `<div style="color: ${colors[type]}; margin: 5px 0;">
        [${timestamp}] [${type.toUpperCase()}] ${message}
      </div>`;
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    }

    // æ•è·é”™è¯¯
    window.onerror = function(msg, url, line, col, error) {
      log(`é”™è¯¯: ${msg}`, 'error');
      if (msg.includes('process is not defined')) {
        statusDiv.innerHTML = '<div class="error">âŒ é”™è¯¯ï¼šprocess is not defined ä»ç„¶å­˜åœ¨ï¼</div>';
      }
      return false;
    };

    // åˆå§‹åŒ–ChatBot
    try {
      log('å¼€å§‹åˆå§‹åŒ– ChatBot Widget...', 'info');
      
      if (typeof ChatBotWidget === 'undefined') {
        throw new Error('ChatBotWidget æœªå®šä¹‰ï¼è„šæœ¬å¯èƒ½åŠ è½½å¤±è´¥ã€‚');
      }
      
      log('ChatBotWidget ç±»å·²æˆåŠŸåŠ è½½', 'success');
      
      chatbot = new ChatBotWidget({
        position: 'bottom-right',
        autoOpen: false
      });
      
      log('ChatBotWidget å®ä¾‹å·²åˆ›å»º', 'success');
      
      chatbot.init();
      
      log('ChatBotWidget åˆå§‹åŒ–æˆåŠŸï¼', 'success');
      
      loadSuccess = true;
      statusDiv.innerHTML = '<div class="success">âœ… æˆåŠŸï¼ChatBot Widget å·²åŠ è½½ï¼Œæ²¡æœ‰ process.env é”™è¯¯ã€‚</div>';
      
    } catch (error) {
      log(`åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
      statusDiv.innerHTML = `<div class="error">âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}</div>`;
      console.error(error);
    }

    // æµ‹è¯•å‡½æ•°
    function testOpen() {
      if (!chatbot) {
        log('ChatBot æœªåˆå§‹åŒ–', 'error');
        return;
      }
      try {
        chatbot.open();
        log('æ‰“å¼€èŠå¤©çª—å£', 'success');
      } catch (error) {
        log(`æ‰“å¼€å¤±è´¥: ${error.message}`, 'error');
      }
    }

    function testClose() {
      if (!chatbot) {
        log('ChatBot æœªåˆå§‹åŒ–', 'error');
        return;
      }
      try {
        chatbot.close();
        log('å…³é—­èŠå¤©çª—å£', 'success');
      } catch (error) {
        log(`å…³é—­å¤±è´¥: ${error.message}`, 'error');
      }
    }

    function testToggle() {
      if (!chatbot) {
        log('ChatBot æœªåˆå§‹åŒ–', 'error');
        return;
      }
      try {
        chatbot.toggle();
        log('åˆ‡æ¢èŠå¤©çª—å£çŠ¶æ€', 'success');
      } catch (error) {
        log(`åˆ‡æ¢å¤±è´¥: ${error.message}`, 'error');
      }
    }

    function reloadPage() {
      location.reload();
    }

    // é¡µé¢åŠ è½½å®Œæˆ
    window.addEventListener('load', function() {
      log('é¡µé¢åŠ è½½å®Œæˆ', 'info');
      if (loadSuccess) {
        log('æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼âœ¨', 'success');
      }
    });
  </script>
</body>
</html>

